---
layout: blog
title: "How to update your password hashing algorithm on a LIVE server"
published: false
---
http://www.phptherightway.com/#password_hashing
<p>Probably need a moment of downtime as you fiddle with your database, I have a few lines in my .htaccess that I can uncomment that routes traffic to a friendly maintenance page.</p>
<p>I'd complete ALL steps on my DEV server, push LIVE (with maintenance page), patch LIVE DB, remove maintenance page.</p>
<ul>
	<li>Add an extra column: password_old</li>
	<li>Copy over the current passwords: UPDATE `users` SET `password_old` = `password`;</li>
	<li>NULL the now master password column: UPDATE `users` SET `password` = NULL; (use an arbitrary string if using NOT NULL)</li>
	<li>Update your registration routine to use new algorithm</li>
	<li>Update your login routine to use old AND new algorithms, check both. If user.password == NULL, update to use new algorithm hash</li>
</ul>
<p>Run that set and you're in no worse a position than you WERE, however every login populates the new password hash.</p>
<p>After an arbitrary amount of time, remove the old algorithm altogether (and the `password_old` column), add a new check to the login routine that says "if `password` is NULL, force the user to use the reset password form". For these guys fly it under the banner of "for added security"...</p>